CREATE TABLE CLIENTS (
    client_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    name VARCHAR2(40 CHAR) NOT NULL,
    surname VARCHAR2(40 CHAR) NOT NULL,
    pesel CHAR(11 CHAR) UNIQUE,
    gender CHAR(1 CHAR) NOT NULL,
    phone_number VARCHAR2(12 CHAR),
    email_address VARCHAR2(40 CHAR),
    CONSTRAINT contact CHECK(phone_number IS NOT NULL OR email_address IS NOT NULL)
);

CREATE TABLE ACCOUNTS (
    account_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    account_number CHAR(26 CHAR) NOT NULL UNIQUE,
    type VARCHAR2(40 CHAR) NOT NULL,
    creation_date DATE NOT NULL,
    closing_date DATE,
    transaction_limit NUMBER(12, 2),
    client_ID NUMBER REFERENCES CLIENTS (client_ID) NOT NULL
);

CREATE TABLE CARDS (
    card_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    type VARCHAR2(1 CHAR) NOT NULL,
    card_number CHAR(16 CHAR) NOT NULL UNIQUE,
    limit NUMBER(12, 2),
    expiration_date DATE,
    blocked CHAR(1) NOT NULL,
    account_ID NUMBER REFERENCES ACCOUNTS (account_ID) NOT NULL
);

CREATE TABLE CURRENCIES (
    name CHAR(3 CHAR) NOT NULL PRIMARY KEY,
    exchange_rate_to_pln NUMBER(12, 2) NOT NULL
);

CREATE TABLE ACCOUNT_CURRENCIES (
    account_currencies_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    balance NUMBER(12, 2) NOT NULL,
    currencies_name CHAR(3 CHAR) REFERENCES CURRENCIES (name) NOT NULL,
    account_ID NUMBER REFERENCES ACCOUNTS (account_ID) NOT NULL
);

CREATE TABLE LOANS (
    loan_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    starting_amount NUMBER (12, 2) NOT NULL,
    current_amount NUMBER (12, 2) NOT NULL,
    date_taken DATE NOT NULL,
    date_due DATE NOT NULL,
    interest NUMBER (8, 4) NOT NULL,
    account_currency_ID NUMBER REFERENCES ACCOUNT_CURRENCIES (account_currencies_ID) NOT NULL
);

CREATE TABLE INVESTMENTS (
    investment_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    date_taken DATE NOT NULL,
    date_ended DATE,
    blocked_until DATE,
    interest_rate NUMBER (8, 4) NOT NULL,
    amount NUMBER (12, 2) NOT NULL,
    account_currency_ID NUMBER REFERENCES ACCOUNT_CURRENCIES (account_currencies_ID) NOT NULL
);

CREATE TABLE INSIDE_TRANSACTIONS_HISTORY (
    inside_transaction_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    amount_before NUMBER (12, 2) NOT NULL,
    amount_after NUMBER (12, 2) NOT NULL,
    transaction_date DATE NOT NULL,
    account_currency_from_ID NUMBER REFERENCES ACCOUNT_CURRENCIES (account_currencies_ID) NOT NULL,
    account_currency_to_ID NUMBER REFERENCES ACCOUNT_CURRENCIES (account_currencies_ID) NOT NULL
);

CREATE TABLE OUTSIDE_TRANSACTIONS_HISTORY (
    outside_transaction_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 PRIMARY KEY,
    outside_account_number VARCHAR2 (30 CHAR) NOT NULL,
    amount NUMBER NOT NULL,
    inside_account_currency_ID NUMBER REFERENCES ACCOUNT_CURRENCIES (account_currencies_ID) NOT NULL
);
